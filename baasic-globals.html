<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="globals-import.html">

<polymer-element name="baasic-globals">
    <script>
        (function () {
            //global static vars used by other components
            var config = {
                //Add additional admin roles here
                adminRoles: ['Administrators'],
                //base Baasic service URL
                baseUrl: "http://api.baasic.local",
                //Baasic version
                version: "beta",
                //Baasic application
                application: "WebComponents",
                //xhr arguments are used with all Ajax calls: when set to true, sync parameter is used to avoid delayed rendering for Ajax-based content
                xhrArgs: { sync: false }
            };
            Polymer('baasic-globals', {
                ready: function () {
                    //assignment of the global singleton variable to the object instance variable per http://stackoverflow.com/questions/24867741/polymer-global-variables that fixes the behavior from http://www.polymer-project.org/docs/polymer/polymer.html#global
                    this.config = config;
                },
                get baasicUser() {
                    var toReturn = this.load('baasicUser') || {};
                    toReturn.isAdmin = baasicUtils.isArrayMatch(this.config.adminRoles, toReturn.roles);
                    return toReturn;
                },
                set baasicUser(val) {
                    this.save('baasicUser', val);
                },
                load: function (name) {
                    var v = localStorage.getItem(name);

                    if (v === null) {
                        return v;
                    } else {
                        try {
                            v = JSON.parse(v);
                        } catch (x) {

                        }
                        return v;
                    }
                },
                save: function (name, objectToSave) {
                    var v = JSON.stringify(objectToSave);
                    localStorage.setItem(name, v);
                }
            });
        })();
    </script>
</polymer-element>